<dom-module id="xsystems-calendar-google">
  <template>
    <style>
      :host {
        @apply(--layout-vertical);
      }

      #calendar {
        @apply(--layout-flex);
        border: none;
      }
    </style>

    <iframe id="calendar" xmlns="http://www.w3.org/1999/xhtml"></iframe>

  </template>
  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'xsystems-calendar-google',

        properties: {
          narrow: Boolean,
          calendars: {
            type: Array,
            value: function() {
              return [];
            }
          },
          timeZone: String,
          language: String,
          backgroundColor: String
        },

        observers: [
          'refreshCalendar(narrow)',
          'refreshCalendar(calendars)',
          'refreshCalendar(timeZone)'
        ],

        refreshCalendar: function() {
          if (this.calendars.length <= 0) {
            return;
          }

          var calendarUrl = 'https://calendar.google.com/calendar/embed?showTitle=0&wkst=2&';

          if (this.narrow) {
            calendarUrl += '&mode=AGENDA&showNav=0&showPrint=0';
          }

          if (this.timeZone) {
            calendarUrl += '&ctz=' + encodeURIComponent(this.timeZone);
          }

          if (this.language) {
            calendarUrl += '&hl=' + this.language;
          }

          if (this.backgroundColor) {
            calendarUrl += '&bgcolor=%23' + this.backgroundColor;
          }

          for (var i = 0; i < this.calendars.length; i++) {
            calendarUrl += '&src=' + encodeURIComponent(this.calendars[i]);
          }

          this.$.calendar.src = calendarUrl;
        }
      });
    })();
  </script>
</dom-module>
