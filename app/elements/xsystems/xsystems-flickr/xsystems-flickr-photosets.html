<dom-module id="xsystems-flickr-photosets">
  <template>
    <style>

    </style>

    <iron-ajax  id="photosetsAjax"
                url="https://api.flickr.com/services/rest/"
                debounce-duration="[[debounceDuration]]"
                last-response="{{_response}}"></iron-ajax>    

  </template>
  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'xsystems-flickr-photosets',

        properties: {
          key: String,
          userId: String,
          page: {
            type: Number,
            value: 1,
            notify: true
          },
          perPage: {
            type: Number,
            value: 5
          },
          primaryPhotoExtras: Array,
          debounceDuration: Number,
          
          pages: {
            type: Number,
            readOnly: true,
            notify: true
          },
          resultsTotal: {
            type: Number,
            readOnly: true,
            notify: true
          },
          items: {
            type: Object,
            readOnly: true,
            notify: true
          }
        },

        observers: [
          '_computeRequestParams(key, userId)',
          '_processResponse(_response)',
          '_fetchPage(page)'
        ],

        _computeRequestParams: function(key, userId) {
          var requestParams = {};
          requestParams.format = 'json';
          requestParams.nojsoncallback = 1;
          requestParams.method = 'flickr.photosets.getList';
          requestParams.api_key = key;
          requestParams.user_id = userId;

          if (this.page != null) {
            requestParams.page = this.page;
          }

          if (this.perPage != null) {
            requestParams.per_page = this.perPage;
          }

          if (this.primaryPhotoExtras != null && this.primaryPhotoExtras.length > 0) {
            requestParams.primary_photo_extras = this.primaryPhotoExtras.join();
          }

          this.$.photosetsAjax.params = requestParams;
          this.$.photosetsAjax.generateRequest();
        },

        _processResponse: function() {
          var photosets = this._response.photosets;

          this._setPages(photosets.pages);
          this._setResultsTotal(photosets.total);
          this._setItems(photosets.photoset);
        },

        _fetchPage: function() {
          this._computeRequestParams(this.key, this.userId);
        }        
      });
    })();
  </script>
</dom-module>
