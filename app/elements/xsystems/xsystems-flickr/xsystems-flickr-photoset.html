<dom-module id="xsystems-flickr-photoset">
  <template>
    <style>

    </style>

    <iron-ajax  id="photosetAjax"
                url="https://api.flickr.com/services/rest/"
                debounce-duration="[[debounceDuration]]"
                last-response="{{_response}}"></iron-ajax>    

  </template>
  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'xsystems-flickr-photoset',

        properties: {
          key: String,
          userId: String,
          photosetId: String,
          page: {
            type: Number,
            value: 1,
            notify: true
          },
          perPage: {
            type: Number,
            value: 5
          },
          extras: Array,
          privacyFilter: Number,
          media: {
            type: String,
            value: 'all'
          },
          debounceDuration: Number,
          
          pages: {
            type: Number,
            readOnly: true,
            notify: true
          },
          resultsTotal: {
            type: Number,
            readOnly: true,
            notify: true
          },
          items: {
            type: Object,
            readOnly: true,
            notify: true
          },
          primary: {
            type: String,
            readOnly: true,
            notify: true            
          },
          owner: {
            type: String,
            readOnly: true,
            notify: true            
          },
          ownerName: {
            type: String,
            readOnly: true,
            notify: true            
          },
          title: {
            type: String,
            readOnly: true,
            notify: true            
          }
        },

        observers: [
          '_computeRequestParams(key, userId, photosetId)',
          '_processResponse(_response)',
          '_fetchPage(page)'
        ],

        _computeRequestParams: function(key, userId, photosetId) {
          var requestParams = {};
          requestParams.format = 'json';
          requestParams.nojsoncallback = 1;
          requestParams.method = 'flickr.photosets.getPhotos';
          requestParams.api_key = key;
          requestParams.user_id = userId;
          requestParams.photoset_id = photosetId;

          if (this.page != null) {
            requestParams.page = this.page;
          }

          if (this.perPage != null) {
            requestParams.per_page = this.perPage;
          }

          if (this.extras != null && this.extras.length > 0) {
            requestParams.extras = this.extras.join();
          }

          if (this.privacyFilter != null) {
            requestParams.privacy_filter = this.privacyFilter;
          }

          if (this.media != null) {
            requestParams.media = this.media;
          }          

          this.$.photosetAjax.params = requestParams;
          this.$.photosetAjax.generateRequest();
        },

        _processResponse: function() {
          if (this._response.stat != "ok") {
            return;
          }

          var photoset = this._response.photoset;

          this._setPages(photoset.pages);
          this._setResultsTotal(photoset.total);
          this._setItems(photoset.photo);

          this._setPrimary(photoset.primary);
          this._setOwner(photoset.owner);
          this._setOwnerName(photoset.ownername);
          this._setTitle(photoset.title);
        },

        _fetchPage: function() {
          this._computeRequestParams(this.key, this.userId, this.photosetId);
        }
      });
    })();
  </script>
</dom-module>
