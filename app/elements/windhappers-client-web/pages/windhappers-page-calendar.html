<dom-module id="windhappers-page-calendar">
  <template>
    <style>
      :host {
        @apply(--layout-vertical);
        height: 100%;
        padding-top: 1%;
        padding-left: 1%;
        padding-right: 1%;
      }

      #calendar {
        @apply(--shadow-elevation-2dp);
        @apply(--layout-flex);
        margin-bottom: 1%;
        min-height: 98%;
      }

      .volunteer-container {
        @apply(--layout-horizontal);
        @apply(--layout-justified);
        @apply(--layout-wrap);
      }

      windhappers-volunteer {
        margin-bottom: 1%;
      }

      :host[narrow] windhappers-volunteer {
        width: 100%;
      }

      :host:not([narrow]) windhappers-volunteer {
        width: 32.66%;
      }
    </style>

    <xsystems-calendar-google id="calendar"
                              narrow$="[[narrow]]"
                              calendars="[[_calendars]]"
                              time-zone="Europe/Amsterdam"
                              language="nl">
    </xsystems-calendar-google>

    <google-sheets  id="sheetVolunteers" 
                key="17WpTzAng1WyamrsJR40S2yECPQJGENhPaM4S0zeSdEY"
                tab-id="1"
                published 
                rows="{{rows}}"></google-sheets>

    <div class="volunteer-container">
      <template is="dom-repeat" items="[[rows]]" as="row" filter="_isRelatedVolunteer">
        <windhappers-volunteer name="{{row.gsx$name.$t}}"
                               function="{{row.gsx$function.$t}}"
                               email="{{row.gsx$email.$t}}"
                               email-personal="{{row.gsx$emailpersonal.$t}}"
                               phone="{{row.gsx$phone.$t}}">
        </windhappers-volunteer>      
      </template>

      <div id="filler"></div>
    </div>
  </template>
  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'windhappers-page-calendar',

        properties: {
          narrow: Boolean,
          _calendars: {
            type: Array,
            value: function() {
              return ['dewindhappers@gmail.com', 'nl.dutch#holiday@group.v.calendar.google.com'];
            }
          }
        },

        observers: [
          '_handleRows(rows)'
        ],
        
        _isRelatedVolunteer: function(row) {
          return ['Winteractiviteiten', 'Kanopolo', 'Toervaren', 'Zeevaren', 'Branding en wildwarevaren', 'Jeugd'].indexOf(row.gsx$function.$t) > -1;
        },

        _handleRows: function(rows) {
          var numberOfRelatedVolunteers = 0;

          for (var i = 0; i < rows.length; i++) {
            if (this._isRelatedVolunteer(rows[i])) {
              numberOfRelatedVolunteers++;
            }
          }

          var numberOfItemsToFillRow = 3 - numberOfRelatedVolunteers % 3;
          if (numberOfItemsToFillRow < 3) {
            this.$.filler.style.width = numberOfItemsToFillRow * 32.66 + '%';
            this.$.filler.style.display = '';
          } else {
            this.$.filler.style.display = 'none';
          }
        }
      });
    })();
  </script>
</dom-module>
