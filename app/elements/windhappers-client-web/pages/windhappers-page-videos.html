<dom-module id="windhappers-page-videos">
  <template>
    <style>
      :host {
        @apply(--layout-vertical);
        padding-left: 1%;
        padding-right: 1%;
      }

      #videoPlayerCard {
        padding: 1%;
      }

      :host:not([narrow]) #videoPlayerCard {
        width: 854px;
        height: 480px;
      }

      :host[narrow] #videoPlayerCard {
        width: 100vw;
        height: 55vw;
      }

      #videoPlayer {
        width: 100%;
        height: 100%;
      }
    </style>

    <app-route  route="{{route}}"
                pattern="/:videoId"
                active="{{videoActive}}"
                data="{{videoData}}"
                tail="{{videoTail}}"></app-route>

    <paper-input id="queryInput" label="Welke video zoek je?" value="{{query}}">
      <paper-icon-button suffix icon="search"></paper-icon-button>
    </paper-input>

    <xsystems-youtube-videos  narrow$="[[narrow]]"
                              key="AIzaSyDTj9__sWn_MKroJ6vlad1pCCidRBi6a5g"
                              query="[[query]]"
                              channel="UCnUYZLuoy1rq1aVMwx4aTzw"
                              selected="{{video}}"></xsystems-youtube-videos>

    <xsystems-overlay id="videoOverlay"
                      on-iron-overlay-closed="_deselectVideo">
      <paper-card id="videoPlayerCard"
                  elevation="5">
        <google-youtube id="videoPlayer"
                        video-id="[[videoData.videoId]]"
                        width="100%"
                        height="100%"
                        rel="0"
                        showinfo="0"
                        iv_load_policy="3"
                        modestbranding="1">
        </google-youtube>
      </paper-card>  
    </xsystems-overlay>    

  </template>
  <script>
    (function() {
      'use strict';
      Polymer({
        is: 'windhappers-page-videos',

        properties: {
          route: Object,
          narrow: Boolean
        },

        observers: [
          '_handleVideoId(videoData.videoId)',
          '_handleSelectedVideo(video)',
          '_handleActive(videoActive)'
        ],

        _handleVideoId: function(videoId) {
          if (videoId != null) {
            this.$.videoOverlay.open();
          } else {
            this.$.videoOverlay.close();
          }
        },

        _handleSelectedVideo: function(video) {
            this.set('route.path', video ? video.id.videoId : '');
        },

        _deselectVideo: function(event) {
          this.$.videoPlayer.pause();
          this.video = null;
        },

        _handleActive: function(videoActive) {
          if (!videoActive) {
            this._handleVideoId(null);
          }
        }
      });
    })();
  </script>
</dom-module>
