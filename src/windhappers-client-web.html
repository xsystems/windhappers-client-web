<link rel="preload" as="image" href="../images/header_default2.jpg">

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-layout/app-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-menu/paper-submenu.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">

<link rel="import" href="windhappers-styles.html">

<link async rel="import" href="../bower_components/xsystems-weather/xsystems-weather.html">
<link async rel="import" href="../bower_components/xsystems-weather/xsystems-weather-service-wunderground.html">
<link async rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link async rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link async rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link async rel="import" href="../bower_components/iron-image/iron-image.html">

<dom-module id="windhappers-client-web">
  <template>
    <style include="windhappers-styles">
      :host [unresolved] {
        @apply --layout-vertical;
        @apply --layout-flex;
        @apply --layout-center;
        @apply --layout-center-justified;
      }

      iron-pages {
        @apply --layout-vertical;
        @apply --layout-flex;
      }

      app-header {
        color: #fff;
        --app-header-background-rear-layer: {
          background-color: var(--primary-color);
        };
        --app-header-background-front-layer: {
          background-image: url(../images/header_default.jpg);
          background-position: left 55%;
        };
      }

      app-toolbar {
        height: 50px;
      }

      :host:not([narrow]) #windhappers-icon {
        height: 100px;
        width: 100%;
        cursor: pointer;
      }

      :host[narrow] #windhappers-icon {
        height: 50px;
        width: 100%;
      }

      [main-title] {
        padding-left: 10%;
        @apply --display1;
      }

      [condensed-title] {
        @apply --headline;
      }

      paper-menu {
        --paper-menu-selected-item: {
          color: var(--primary-color);
        }
      }

      paper-menu, paper-submenu paper-item {
        text-rendering: optimizeLegibility;
      }

      paper-submenu paper-menu {
        padding-left: 10%;
      }

      #drawer {
        --app-drawer-width: 200px;
      }

      #drawerContent {
        height: 100%;
        overflow: auto;
      }

      #facebook {
        --iron-icon-width: 16px;
        --iron-icon-height: 16px;
      }

      xsystems-weather {
        margin: 6%;
      }
    </style>

    <app-location route="{{route}}"></app-location>

    <app-route  route="{{route}}"
                pattern="/:page"
                data="{{pageData}}"
                tail="{{pageTail}}"></app-route>

    <app-drawer-layout  fullbleed
                        narrow="{{narrow}}"
                        responsive-width="768px">
      <app-drawer id="drawer" swipe-open>
        <div id="drawerContent">
          <iron-image id="windhappers-icon"
                      on-tap="_showPageHome"
                      sizing="contain"
                      src="../images/windhappers-icon_1024x1024.png"
                      alt="De Windhappers">
          </iron-image>

          <paper-menu selectable="paper-item"
                      selected="{{pageData.page}}"
                      attr-for-selected="data-page">
            <paper-item data-page="home">Home</paper-item>
            <paper-item data-page="calendar">Kalender</paper-item>
            <paper-item data-page="disciplines">Disciplines</paper-item>
            <paper-submenu>
              <paper-item class="menu-trigger">Media</paper-item>
              <paper-menu class="menu-content"
                          selectable="paper-item"
                          selected="{{pageData.page}}"
                          attr-for-selected="data-page">
                <paper-item data-page="photos">Foto's</paper-item>
                <paper-item data-page="videos">Video's</paper-item>
                <!-- <paper-item data-page="blogs">Blogs</paper-item> -->
              </paper-menu>
            </paper-submenu>
            <!-- <paper-item data-page="canoeroutes">Kanoroutes</paper-item> -->
            <paper-submenu id="menuSafety">
              <paper-item class="menu-trigger">Veiligheid</paper-item>
              <paper-menu class="menu-content">
                <paper-item on-tap="_showPageWaterQuality">Waterkwaliteit</paper-item>
                <paper-item on-tap="_showPageKNRM">KNRM App</paper-item>
              </paper-menu>
            </paper-submenu>
            <paper-item data-page="costs">Kosten &amp; Inschrijven</paper-item>
            <paper-submenu>
              <paper-item class="menu-trigger">Over ons</paper-item>
              <paper-menu class="menu-content"
                          selectable="paper-item"
                          selected="{{pageData.page}}"
                          attr-for-selected="data-page">
                <paper-item data-page="contact">Contact</paper-item>
                <paper-item data-page="location">Locatie</paper-item>
              </paper-menu>
            </paper-submenu>
            <paper-item data-page="documents">Documenten</paper-item>
          </paper-menu>

          <xsystems-weather-service-wunderground  key="d543a18b79ebf11a"
                                                  query="Netherlands/The_Hague"
                                                  data="{{forecast}}"></xsystems-weather-service-wunderground>
          <xsystems-weather data="[[forecast]]"></xsystems-weather>
        </div>
      </app-drawer>
      <app-header-layout fullbleed has-scrolling-region>
        <app-header id="header" fixed condenses effects="material">
          <app-toolbar sticky>
            <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
            <span condensed-title>De Windhappers</span>
            <a href="https://twitter.com/DeWindhappers" target="_blank" rel="noopener">
              <iron-icon src="../images/twitter.png"></iron-icon>
            </a>
            <a href="https://www.facebook.com/Windhappers-227735227966870" target="_blank" rel="noopener">
              <iron-icon id="facebook" src="../images/facebook.png"></iron-icon>
            </a>
          </app-toolbar>
          <app-toolbar class="secondary">
            <span main-title>De Windhappers</span>
          </app-toolbar>
        </app-header>

        <iron-pages selected="[[page]]"
                             attr-for-selected="data-page"
                             selected-attribute="active">
          <windhappers-page-home unresolved data-page="home" narrow$="[[narrow]]">
            <paper-spinner alt="Loading home page" active></paper-spinner>
          </windhappers-page-home>

          <windhappers-page-calendar unresolved data-page="calendar" narrow$="[[narrow]]">
            <paper-spinner alt="Loading calendar page" active></paper-spinner>
          </windhappers-page-calendar>

          <windhappers-page-disciplines unresolved data-page="disciplines" narrow$="[[narrow]]" route="{{pageTail}}">
            <paper-spinner alt="Loading disciplines page" active></paper-spinner>
          </windhappers-page-disciplines>

          <windhappers-page-photos unresolved data-page="photos" narrow$="[[narrow]]" route="{{pageTail}}" scroll-target="[[_getScrollTarget()]]">
            <paper-spinner alt="Loading photos page" active></paper-spinner>
          </windhappers-page-photos>

          <windhappers-page-videos unresolved data-page="videos" narrow$="[[narrow]]" route="{{pageTail}}" scroll-target="[[_getScrollTarget()]]">
            <paper-spinner alt="Loading videos page" active></paper-spinner>
          </windhappers-page-videos>

          <windhappers-page-contact unresolved data-page="contact" narrow$="[[narrow]]">
            <paper-spinner alt="Loading contact page" active></paper-spinner>
          </windhappers-page-contact>

          <windhappers-page-location unresolved data-page="location" narrow$="[[narrow]]">
            <paper-spinner alt="Loading location page" active></paper-spinner>
          </windhappers-page-location>

          <windhappers-page-costs unresolved data-page="costs" narrow$="[[narrow]]">
            <paper-spinner alt="Loading costs page" active></paper-spinner>
          </windhappers-page-costs>

          <windhappers-page-404 id="page404" unresolved data-page="404" narrow$="[[narrow]]">
            <paper-spinner alt="Loading 404 page" active></paper-spinner>
          </windhappers-page-404>

          <windhappers-page-documents unresolved data-page="documents" narrow$="[[narrow]]">
            <paper-spinner alt="Loading Windhappers documents page" active></paper-spinner>
          </windhappers-page-documents>
        </iron-pages>
      </app-header-layout>
    </app-drawer-layout>

  </template>

  <script>
    window.performance && performance.mark && performance.mark('windhappers-client-web: before register');

    (function() {
      'use strict';
      Polymer({
        is: 'windhappers-client-web',

        properties: {
          narrow: {
            type: Boolean,
            notify: true,
            reflectToAttribute: true,
            value: false
          },
          page: {
            type: String,
            observer: '_pageChanged'
          },
        },

        observers: [
          '_updateMenus(pageData.page)',
          '_routePageChanged(pageData.page)'
        ],

        created: function() {
          window.performance && performance.mark && performance.mark('windhappers-client-web: created');
          this.removeAttribute('unresolved');
        },

        _routePageChanged: function(page) {
          this.page = page || 'home';
          if (this.narrow) {
            this.$.drawer.opened = false;
          }
        },

        _pageChanged: function(page, oldPage) {
          if (page) {
            this.importHref(
              this.resolveUrl('windhappers-page-' + page + '.html'),
              null, this._handleFailedImport, true);
          }
        },

        _handleFailedImport: function(event) {
          this.$.page404.url = event.srcElement.href;
          this.page = '404';
        },

        _showPageHome: function() {
          this.set('route.path', '/home');
        },

        _showPageWaterQuality: function() {
          window.open("http://zwemwater.nl/", "_blank");
        },

        _showPageKNRM: function() {
          window.open("https://www.knrm.nl/wat-doet-de-knrm/veiligheid-voor-pleziervaart/knrm-helpt-app/", "_blank");
        },

        _updateMenus: function(page) {
          if (this.$.menuSafety.opened) {
            this.$.menuSafety.close();
          }
        },

        _getScrollTarget: function() {
          return this.$.header.scrollTarget;
        }
      })
    })();
  </script>
</dom-module>
